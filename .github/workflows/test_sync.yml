   
name: Sync staging with master (create PR)
on:
  push:
    branches:
      - master
jobs:
  sync-branches:
    runs-on: ubuntu-latest
    name: Syncing branches - staging
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Node
        uses: actions/setup-node@v2

      - name: Opening pull request
        id: pullrequest
        uses: tretuna/sync-branches@1.4.0
        with:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
          FROM_BRANCH: "master"
          TO_BRANCH: "staging"
          PULL_REQUEST_TITLE: "[sync-branches] Sync `staging` with `master`"
          REVIEWERS: '["jgsogo"]'

      - name: Enable automerge (MERGE)
        run: |
          echo "(${{ steps.pullrequest.outputs.PULL_REQUEST_NUMBER }}) ${{ steps.pullrequest.outputs.PULL_REQUEST_URL }}"
          curl -H "Authorization: Bearer ${{secrets.GITHUB_TOKEN}}" -X POST -d " \
          mutation MyMutation { \
              enablePullRequestAutoMerge(input: {pullRequestId: \"${{ steps.pullrequest.outputs.PULL_REQUEST_NUMBER }}\", mergeMethod: \"MERGE\"}) {
                                                  clientMutationId \
              } \
          } \
          " https://api.github.com/graphql
